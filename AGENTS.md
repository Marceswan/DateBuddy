# Repository Guidelines

## Project Structure & Module Organization
- `sfdx-project.json`: SFDX project config.
- `force-app/main/default/classes/`: Apex classes and tests (`*.cls`, `*.cls-meta.xml`).
- `force-app/main/default/triggers/`: Trigger files (generated by deployer or added manually).
- `force-app/main/default/pages/DateBuddySession.page`: VF session page for apex-mdapi.
- `force-app/main/default/lwc/dateBuddyTriggerDeployer/`: LWC to deploy object triggers.
- `force-app/main/default/classes/MetadataService.cls`: Vendored apex-mdapi library.
- `.forceignore` / `.gitignore`: Ignore lists for deploys and Git.

## Build, Test, and Development Commands
- `sf deploy metadata -o <alias> --metadata ApexClass,ApexTrigger`: Deploy classes/triggers.
- `sf apex test run -o <alias> --result-format human`: Run Apex tests.
- `sf apex run -o <alias> --file scripts/deployTrigger.apex`: Run Anonymous Apex to deploy a trigger for the specified object.
- Alternative (legacy): replace `sf` with `sfdx` equivalents if preferred.
 - To use the LWC, add it to a Lightning page. apex-mdapi (`MetadataService.cls`) is vendored in this repo.
 - Configure ONLY a Remote Site Setting to your org base URL (e.g., `https://your-domain.my.salesforce.com`). Do not use Named Credentials.

## Coding Style & Naming Conventions
- Indentation: 4 spaces; line length ~120.
- Class names: `PascalCase` (e.g., `DateBuddyHandler`).
- Trigger names: `DateStamp_<Object>_BT` for before-save triggers.
- Methods: `camelCase`; tests use `testMethodName_pattern`.
- Use bulk-safe patterns and avoid SOQL/DML inside loops.

## Testing Guidelines
- Framework: Apex unit tests (`@isTest`, `seeAllData=false`).
- Naming: `<ClassName>Test.cls` for unit tests.
- Coverage: target ≥ 85% on touched classes; avoid testing CMDT presence—mock behaviors when possible.
- Run: `sf apex test run -o <alias> --tests <ClassName>Test` during changes.

## Commit & Pull Request Guidelines
- Commits: short imperative subject, scoped (e.g., `feat(handler): add before-save logic`).
- Include why and what changed; group related edits.
- PRs: clear description, link issues, include test results, and any org/deploy notes.
- Screenshots or logs: attach when behavior changes or errors were fixed.

## Agent-Specific Instructions
- New workflow: use `DateStampTriggerDeployer.deploy('<ObjectApiName>')` via Anonymous Apex to create per-object before-save triggers that call `DateBuddyHandler`.
- The invocable `UpdateDateFieldAction` remains available for Flow; both paths read the same CMDT (`Date_Stamp_Mapping__mdt`).
- If `MetadataService` (apex-mdapi) isn’t in the org, install it before deploying triggers. Also ensure the VF page `/apex/DateBuddySession` exists for session bridging as per apex-mdapi examples.

## LWC Enhancements
- Status poller: LWC automatically polls `getStatus(asyncId)` for `AsyncResult.state` until `done=true` or timeout (~30s), with toast confirmations.
- Object picker: LWC loads SObject API names from `DateBuddyDeployController.listSObjects()` into a `lightning-combobox`.
- View source: After success, displays the deployed trigger source using the deployer’s generator; button available to fetch on demand.
- Retry: If deployment errors or times out, a `Retry Deploy` button becomes available.

## Vendoring apex-mdapi
- `MetadataService.cls` is included from certinia/apex-mdapi. Keep it updated as needed.
- Follow the upstream README for Remote Site Settings and session page usage (`/apex/DateBuddySession`). Named Credentials are not required and not used here.
